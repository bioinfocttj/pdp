\chapter{Conception}

\section{Généralités de conception}
\subsection{L'interface graphique}
Comme précisé précédemment, notre programme se présente sous la forme d'un plugin \imj . L'interface graphique à été réalisée grâce à la bibliothèque  \java ~Swing, %Il a été réalisé grâce à la bibliothèque Swing de \java ~pour l'interface graphique.
La fenêtre servant d'interface est composée de differentes boites (panneaux). Ces boites contiennent différents outils (boutons, listes, zones de saisie et zones de texte) permettant l'interaction entre l'utilisateur et le programme. Les boîtes peuvent s'imbriquer les unes dans les autres afin d'obtenir des structures plus complexes et un meilleur rendu visuel. \\
%Nous avons donc créé une série d'outils graphiques (boutons, listes, zone de saisie et zone de texte) pour l'interaction avec l'utilisateur. Dans une fenêtre, ces outils sont disposés en lignes ou en colonnes dans des boîtes (panels). Les boîtes peuvent s'imbriquer les unes dans les autres afin d'obtenir des structures plus complexes et un meilleur rendu visuel. \\
L'interface du plugin est simple, elle prend la forme d'une fenêtre composée d'un menu déroulant, dans lequel se trouvent les différents algorithmes, et de quatre boutons. \\

\subsubsection{Les panneaux}

Notre interface est composée d'une arborescence de panneaux organisée comme suit : \\
Un panneau principal, permettant d'organiser la fenetre du plugin, composé des trois panneaux subsidiaires suivant :
%Notre interface est composée de quatre panneaux différents (voir Figure \ref{panneaux}) :
\begin{description}
\item [Le premier panneau] contient une liste déroulante permettant le choix de l'algorithme. 
%\item Le panneau en haut de la fenêtre contient une liste déroulante pour le choix de l'algorithme. 
\item [le panneau du milieu] est vide au lancement du plugin et s'actualise en fonction de l'algorithme de piquage choisi.\\
Il affiche une aide rapide sur les condition d'utilisation de l'algorithme de piquage, les zones de saisies utilisateur propre à cet algorithme, les choix génériques : mode de deboggage, mode de découpe des selections et taille de la selection, gestion du bruit de fond. Tout cela s'organise à l'aide de sous-panneaux.
%\item Le panel du milieu est vide au lancement du plugin et son contenu s'actualise en fonction de l'algorithme de piquage choisi. Il contient 4 sous-panneaux :
%\begin{itemize}
%\item Le premier sous-panneau contient une zone de texte visant à guider l'utilisateur sur la manière de lancer la procédure de piquage choisie. 
%\item Le deuxième sous-panneau se situe au milieu et change en fonction de l'algorithme choisi. Il conporte un nom différent suivant l'algorithme choisi : il va se nommer \textbf{iterationPanel} pour Dilate Difference, \textbf{sigmaPanel} pour Difference of Gaussian et \textbf{radiusPanel} pour Image Correlation. Ces sous-panels contiennent deux ou trois TextFields (zones de texte à une seule ligne) pour que l'utilisateur puisse entrer les valeurs des paramètres nécessaires au bon fonctionnement des algorithmes. 
%\item Le troisième sous-panel (\textbf{widthNoisePanel}) quand à lui contient deux TextFields pour les paramètres \textbf{Square width} et \textbf{Noise Tolerance} sur lesquels nous reviendrons par la suite. 
%\item Le dernier sous-panel (\textbf{debugCropPanel}) contient deux checkboxs pour les modes de debug et crop (voir plus loin dans le rapport). 
%\end{itemize}
\item [le dernier panneau] contient les boutons d'actions : prévisualisation, éxécution, affichage des résultats, informations/aide.
%\item Le panel en bas de la fenêtre (\textbf{panel3}) contient quatre boutons qui permettent à l'utilisateur de faire fonctionner le plugin. 
%\item Le panel principal (\textbf{mainPanel}) contient tous les panels cités précédemment. Sa taille détermine celle de la fenêtre du plugin. 
\end{description}
Le panneau principal permet notamment d'imposer la taille de l'interface.\\
La figure suivante (\ref{panneaux}) donne un aperçu plus visuel de l'organisation de ces différents panneaux.
\begin{figure}[!h] 
\includegraphics[width=1\textwidth]{plugin3-1.png}
\caption{Organisation des panels pour l'algorithme Difference of Gaussian}
\label{panneaux}
\end{figure}
\pagebreak
\subsubsection{Les boutons}

Les boutons doivent répondre aux clics de la souris et lancer l'action correspondante en fonction de l'algorithme de piquage choisi par l'utilisateur :

\begin{description}
\item [Le bouton de prévisualisation] permet de tester le piquage obtenu par l'algorithme sélectionné sur l'image courante.
\item [Le bouton d'éxécution] permet d'appliquer l'algorithme sur l'image ou le stack séléctionné, lorsque l'utilisateur est s\^ur des paramètres qu'il souhaite appliquer.
\item [Le bouton d'information/aide] est une aide d'utilisation du plugin ainsi que des conditions de fonctionnement des algorithmes.
\item [Le bouton d'affichage des résultats] permet d'afficher et de sauvegarder le tableau des coordonnées des particules sélectionnées.% avec l'aide d'\imj.  
\end{description}
Pour que le plugin puisse fonctionner, l'utilisateur devra au préalable avoir ouvert une image ou un stack d'images à l'aide d'\imj.
\pagebreak
\subsection{les algorithmes}
L'utilisateur sélectionne un algorithme dans le menu déroulant et détermine certains paramètres :\\
%Lorsque l'utilisateur sélectionne un algorithme dans le menu déroulant, il doit choisir plusieurs paramètres.
Certains sont communs à tous tel que :
\begin{itemize}
\item la gestion du bruit de fond,
\item la taille des images des particules sélectionnées lorsqu'on demande le stack d'images,
\item activation du deboggage (s'il est implémenté dans l'algorithme),
\item activation du découpage des particules à partir du piquage obtenu.
\end{itemize}
D'autres sont propres aux algorithmes.
\subsubsection{Correlation d'image}
Le principe de cette méthode est de corréler une image de cercle d'une taille définie avec notre image de base convertie en image binaire. Pour chaque pixel noir on trace le cercle avec ce pixel pour centre.
Si le cercle est de la m\^eme taille que la particule, les cercles se croiseront tous au centre de cette particule formant un point blanc central. On obtient donc une image résultante de corrélation présentant des maxima blancs au centre de chaque particules dont la taille est identique à celle du cercle.\\
Cet algorithme trouve donc les valeurs élevées de pixel correspondant à la meilleure superposition locale entre l'image de référence (le cercle) et l'image de base.\\

%Le principe de cette méthode est de comparer une image contenant un cercle avec l'image sur laquelle on veut sélectionner les particules. On obtient alors une nouvelle image sur laquelle on peut voir des cercles correspondant aux particules de l'image de base qui ont à peu près le même diamètre que le cercle dessiné précédemment. Ici, on fait varier la taille du cercle afin de sélectionner des particules de différentes tailles.\\
\noindent
Pour cette méthode de piquage, l'utilisateur doit donc entrer le rayon minimal et maximal des particules à sélectionner, ainsi que la valeur de l'incrémentation.\\ Pour un résultat optimal, avant de lancer la sélection des particules avec cet algorithme, l'utilisateur devra traiter l'image pour éliminer un maximum de bruit de fond (utilisation de filtres).

\subsubsection{Différence de Gaussienne}
La différence de Gauss est une technique qui consiste en la soustraction d'une image à laquelle à été appliqué un filtre gaussien à une deuxième image moins filtrée avec un écart-type plus petit. Les bords des particules sont donc dégradés nous permettant de récupèrer les maxima de l'image résultante, c'est-à-dire les centres des particules.\\
%La différence de Gauss est une technique qui consiste en la soustraction d'une version floutée %de l'image d'origine à une autre version moins floutée de cette même image.\\
\noindent
On demande à l'utilisateur d'entrer les valeurs d'écart-type qui seront utilisés pour appliquer les filtres gaussiens.

\subsubsection{Différence de dilatation}

Cette méthode repose sur le même principe que la différence de Gaussienne à ceci près que l'image d'origine n'est pas floutée mais on lui applique un certain nombre de cycles de dilatation, on obtient alors des particules de plus grandes tailles. A la soustraction des deux images, seuls les contours des particules apparaitront, nous permettant de récuperer les centres de particules.\\
L'utilisateur devra entrer les nombres de cycles de dilatation qu'il souhaite appliquer à chaque image.


%\section{Les classes}
%
%Le programme est divisé en seize classes distinctes:
%\begin{list}{

%\item Une première partie regroupe six classes qui permettent de gérer l'interface graphique.
%\item
%\item Une seconde partie regroupe les algorithmes de piquage, elle est composée de quatre classes.
%\item La classe \texttt{AlgoFactory} sert de pivot au programme en fonction du choix d'algorithme de l'utilisateur (adaptation de l'interface et algorithme de piquage).
%\item La classe \texttt{Attributes} est un singleton (instanciable qu'une seule et unique fois) et contient tous les paramètres à entrer par l'utilisateur pour faire fonctionner les algorithmes.
%\item La classe \texttt{Cropper} est une fonction subsidiaire du piquage permettant de créer un stack dans lequel chaque image contient une particule piquée (si l'utilisateur le demande).
%\item La classe \texttt{FFTMath} contient la méthode permettant de faire la Corrélation d'images.
%\item Les classes \texttt{About} et \texttt{InfoHelp} contiennent des informations et une aide sur l'utilisation du plugin.
%\end{list}
%
%\subsection{Les classes de l'interfaces}
%
%La classe \texttt{Pick\_EM} fait le lien entre \imj ~et la classe \texttt{PickFrame} qui est une JFrame, elle permet de créer l'interface graphique.\\
%Vient ensuite la classe \texttt{PickPanel} qui permet d'adapter l'interface en fonction de l'algorithme. En découlent \texttt{PanelDilateDiff}, \texttt{PanelDoG} et \texttt{PanelImCorr} pour leurs algorithmes respectifs (Dilate Difference, Difference Of Gaussian et Image Correlation).
%
%\subsection{Les classes des algorithmes}
%
%La classe \texttt{Picker} est utilisée pour appeler les algorithmes. Les algorithmes étant \texttt{DialteDiff}, \texttt{DoG} et \texttt{ImCorr}.
%Pour faire fonctionner ces algorithmes, la classe \texttt{Attributes} renvoie les valeurs des paramètres entrés par l'utilisateur.
